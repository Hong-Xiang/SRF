# 任务/系统 整理

## 系统

### 全身PET/CT

面向临床。研发阶段，所以有工程化问题和科研内容。

目标式全身PET/CT从硬件（电路等）和软件（重建，图像处理，UI），仿真，
工业设计等。

是我们目前阶段最主干的内容。

#### 硬件部分

1. 系统方案设计 

    *已完成*

    检测器方案：
    读出电路方案、系统级方案 都基本设计完成

2. 检测器设计

      1. 晶体加工采购（规格确定，招标采购）
      2. 光学传感器阵列设计和制作
      3. 探测器组装，光学耦合

    SiPM第一版电路设计已完成，贴片中；第二版正在实施；
    晶体和SiPM正在采购, 到位后开始加工
    传感器电路设计已完成

3. 读出电路

    1. 模拟版（接探测器的）

        电路方案的确定，两种方案确定，二选一。

        第一种方案马上投版；

        第二种2018.4.3启动；

        最终版电路设计和加工；

    2. FPGA版

        PCB设计完成，小批量加工中，采购；

        大批量加工，采购

    主电路已经设计完成，正在加工
    能量和时间原型验证电路设计已经完成，准备投板
    能量和时间原型验证定型后会启动最终版设计

4. 检测器级固件

    第一代固件基本完成。

    固件移植，TDC（时间数字转换器，应用包括TOF，目前做到10ps级别）整合。

    模块间传输，收发器开发，带宽达到2.5G。

    在拿到上述主电路后开始进行开发

    基本沿用初代设计、需要整合高精度TDC

    需要开发2.5G收发器

5. 符合处理电路

    方案：使用第三方硬件；在线符合；

    硬件方案已确定，主电路已经到货，光纤子卡已经到位；

    与模块间通信固件正在开发中；

    与PC间万兆以太网通信正在开发中；

    符合处理需要等待模块级开发完成，预研阶段

6. 供电系统

    暂定采用第三方医疗级电源模块，需要选型和采购，联系供应商

7. 冷却系统

    检测器级别采用了水冷方案，需要控温精度满足需求

    选型，采购

8. 操作面板

    嵌入式开发，可以采取第三方方案

    开发未启动

9. 其他硬件

    需求还不确定，需要调研

    摄像头，温度传感器等；

    用于维护，测试的接口；

    门控，需要调研，留出通信接口；

目前在进行的都是核心硬件的设计，总体的时间规划还没有但是可以做了（之前没经验不能上来就做顶层设计）。但是不清楚一台商业化的系统还需要哪些外围硬件，暂时也没有精力做，所以这些估计需要边做边完善，或者引入有经验熟悉PET产品的人员，否则很难一下拿出产品级的设计。
另外所有的硬件设计都没涉及CT部分，用第三方CT集成主要涉及接口部分，需要等有具体的CT型号和技术资料再开展，这部分相比PET本身的硬件设计工作量不大。

#### 机械设计

依托无锡研究院的工程师；

panel级别封装完成度80%；

在此基础上机架设计需要等CT机架，panel封装等设计完成；

外壳设计；

病床设计使用滑轨方案；

模块级封装设计在进行中，目前在等待模块级硬件结构定型
系统级结构设计等待模块级设计完成
病床设计可能可以采用大系统的设计，但不确定

总体来说，机械设计基本停滞状态； 机械设计同硬件设计一样都是围绕核心部分，很多细节设计一开始能考虑到，预计需要2到3代的改进，才能满足商业化系统的需求。

模块级封装设计在进行中，目前在等待模块级硬件结构定型
系统级结构设计等待模块级设计完成
病床设计可能可以采用大系统的设计，但不确定

总体来说，机械设计基本停滞状态； 机械设计同硬件设计一样都是围绕核心部分，很多细节设计一开始能考虑到，预计需要2到3代的改进，才能满足商业化系统的需求。

#### 与CT集成

#### 软件部分

##### 重建

1. 重建算法部分 [ZYL, CGY, TWJ, HX]

    1. list-mode
        1. TOF接口 
        实现的投影模型：
            1. siddon 稳定使用
            2. tor 需要测试
    2. sinogram
        1. 程序改写（研发完成，需要分布式实现）
    3. corrections （均未完成研发）
        1. 衰减校正
        2. 散射校正
        3. PVE
        4. PSF [WFH]
        5. motion
    4. 动态重建 [LPH] 

    CPU实现任意探测器的list-mode

##### 软件平台

1. 平台本身构架 [LXL]
    1. 采用linkerd做微服务管理（负载均衡）
    2. consul：服务发现
    3. 通信协议：gRPC
        每个服务需要封装对应API [LXL, HX]
    4. 后端框架: echo

2. pygate服务
    1. RPC后端（与echo的结合）[LXL]
    2. 文档工作 [WH]
    3. 实现部分的优化工作（比如mac生成库的完善）[LL, CGY]
        1. 封装到yml层 [WFH, LL]（仅通过配置文件，无需写python代码控制mac生成）
    4. 数据分析算子的添加 [WFH, HX, TWJ]
    5. 添加单元测试 [LL, HX]

3. 可扩展重建框架（SRF）

    1. 节点（容器）层
        0. Tensorflow 底层接口 [HX, JYK, CGY]
            barrier 
            数据封装
        1. 底层OP [CGY, ZYL]
            siddon 模型
            tor 模型
            fft
        2. 中层模型 [HX, TWJ, CGY]
            投影反投影
            迭代算法计算图
            siongram相关计算图
        3. 顶层任务模型
            efficiency map计算
            MLEM迭代
            sinogram重建任务

        4. 顶层API完善和设计
            1. 多机调度 [ZQL]
            2. 文件输入[LXL]
            3. RPC接口 [HX]
            4. 内存优化 [CGY]

    2. 分布式调度层 [ZQL, 招1人]
        1. 容器 [HX]
            服务封装 （基础功能封装）
            启动容器
        2. 容器间交互
            利用k8s完成 （初步调研完成，稳定性问题要解决）
            容器间交互需要结合微服务框架
        3. 分布式存储优化
        4. 任务调度系统
        5. 硬件支持
            服务器采购

4. 数据处理
    1. Dicom转换处理 [LXL]
    2. 仿真数据后处理 [WFH, HX, LL, TWJ]
        1. 提取单次时间数据
        2. histogram
    3. 图像处理 [WH, 招1人]

        分割

        配准

        可视化 [CGY]

        三维重构

        特定位置的高级处理应用（主要使用第三方库，需要少量修改）

    4. 数据分析

        动态模型 [LPH]

        统计分析 [LXY]

        深度学习 [HX]

5. WEB UI (前端) [LXL, 招1人]
    1. volume viewer [CGY]
    2. pygate 前端 [LXL]
    3. 文件系统浏览器
    4. 文本文件修改
    5. 下位机底层控制 [LXL]

##### 软件开发范式

1. 推广单元测试  
2. 版本控制系统，持续集成 [LXY]
3. 文档规范化
4. 代码质量控制

### 头部式系统

#### 原型设计开发

16模块的集成

#### 成像实验

1. 点源实验
2. 体模实验
3. 动物实验

加周边设备（VR跑步机；VR内容定制，采购）

应用调研；

需要软件平台提供：重建，UI，可视化，

第一代的电子/检测器等的验证。第一代本周内可以出图像。

下一代需要在大系统的硬件等完成后，需要用大系统的硬件来优化。

### 小动物系统

市场调研；

检测器方案设计（如何解码等）；

系统方案设计（最终的模块数，视野等，已有初步方案）；

结构设计；

工业设计；

同样利用大系统的硬件，改变的是晶体大小，阵列大小等（3x4->2x6），需要仿真的配合。（头部系统也有类似的问题）

小动物PET/CT的目前目标是做成桌面式的设备，需要寻找小的CT提供商。
也有一定的先例，可以参考。

### PET科研

多面体PET仿真/重建；

连续晶体解码；

重建模型优化；

多模态数据用于重建；

深度学习应用；

### 连续晶体

连续晶体环的仿真，实验等。

### 变孔径系统

### 超长PET

1.4m的PET系统 [WFH, CGY, TWJ, HX, ZYL, LXY]

1. 仿真 [WFH]
2. 重建
3. evaluation

### PMT系统

PMT系统结题 [WFH]

两篇文章 [WH]

实验 [ZYL, ZZX]